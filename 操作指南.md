# 销售分析系统 - 初学者操作指南

## 👋 欢迎使用

亲爱的初学者朋友，欢迎使用这个销售分析系统！这是一个专为初学者设计的后端项目，通过这个指南，你将学会如何在你的 MacOS 电脑上安装环境、运行项目并进行测试。

## 📋 准备工作清单

在开始之前，请确保你的电脑上有以下软件：
- MacOS 14.0（已确认）
- M1 Pro 处理器（已确认）

## 🔧 安装 Docker Desktop

Docker 是一个神奇的工具，它可以帮助我们轻松运行各种软件，而不需要复杂的安装过程。

### 步骤 1：下载 Docker Desktop

1. 打开你的浏览器（Safari 或 Chrome 都可以）
2. 访问 [Docker 官方下载页面](https://docs.docker.com/desktop/install/mac-install/)
3. 点击下载按钮，选择适合 M1 芯片的版本（通常标记为 "Apple Silicon"）

### 步骤 2：安装 Docker Desktop

1. 找到下载的安装包（通常在 "下载" 文件夹中）
2. 双击安装包打开
3. 将 Docker 图标拖到 "应用程序" 文件夹中
4. 等待安装完成

### 步骤 3：启动 Docker Desktop

1. 打开 "启动台"（Launchpad）
2. 找到 Docker 应用并点击打开
3. 首次启动时，系统会要求输入你的电脑密码，请输入并点击 "好"
4. 等待 Docker 启动完成（右下角会显示 Docker 图标）

### 步骤 4：验证 Docker 是否安装成功

1. 打开 "终端" 应用（可以通过 Spotlight 搜索 "终端"）
2. 输入以下命令并按回车：
   ```bash
   docker --version
   ```
3. 如果看到类似 `Docker version 24.0.5, build ced0996` 的输出，说明安装成功！
4. 再输入以下命令并按回车：
   ```bash
   docker-compose --version
   ```
5. 如果看到类似 `docker-compose version v2.20.2` 的输出，说明 Docker Compose 也安装成功！

## 📂 准备项目文件

### 步骤 1：进入项目目录

1. 打开 "终端"
2. 输入以下命令并按回车，进入项目目录：
   ```bash
   cd /Users/djs/Trae/houduanB
   ```

### 步骤 2：查看项目文件

1. 输入以下命令查看项目文件：
   ```bash
   ls -la
   ```
2. 你应该能看到项目的所有文件，包括 `docker-compose.yml`、`Dockerfile`、`pom.xml` 等

## 🚀 启动项目

### 步骤 1：使用 Docker Compose 启动服务

1. 在终端中输入以下命令并按回车：
   ```bash
   docker-compose up -d
   ```
2. 这个命令会下载所需的软件包并启动服务，可能需要一些时间，请耐心等待
3. 当你看到终端不再输出新信息，并且提示符再次出现时，说明启动完成

### 步骤 2：检查服务是否启动成功

1. 输入以下命令查看正在运行的容器：
   ```bash
   docker ps
   ```
2. 你应该能看到两个正在运行的容器，一个是 MySQL 数据库，另一个是 Spring Boot 应用

## 🗄️ 初始化数据库

### 步骤 1：进入数据库脚本目录

1. 在终端中输入以下命令并按回车：
   ```bash
   cd db
   ```

### 步骤 2：执行数据库初始化脚本

1. 输入以下命令创建数据库和表：
   ```bash
   docker exec -i $(docker ps -q -f name=mysql) mysql -u root -prootpassword < init.sql
   ```
2. 如果没有错误信息输出，说明数据库创建成功

### 步骤 3：导入测试数据

1. 输入以下命令导入基础测试数据：
   ```bash
   docker exec -i $(docker ps -q -f name=mysql) mysql -u root -prootpassword < import_data.sql
   ```
2. 导入完成后，你应该能看到类似 `100 rows affected` 的信息

### 步骤 4：生成并导入大量测试数据

系统提供了一个专门的脚本来从 Mockaroo API 获取大量测试数据：

1. 返回项目根目录：
   ```bash
   cd ..
   ```

2. 确保脚本具有执行权限：
   ```bash
   chmod +x run_mockaroo_data_loader.sh
   ```

3. 运行脚本生成并导入1000条测试数据：
   ```bash
   ./run_mockaroo_data_loader.sh
   ```

4. 脚本执行过程中会显示进度信息，完成后会显示成功导入的数据条数

### 步骤 5：验证数据导入

1. 连接到数据库检查数据：
   ```bash
   docker exec -it $(docker ps -q -f name=mysql) mysql -u root -prootpassword
   ```

2. 在 MySQL 命令行中执行以下命令：
   ```sql
   USE taskdb;
   SELECT COUNT(*) FROM sales;
   ```

3. 你应该能看到 sales 表中的记录总数（应该超过1000条）

4. 输入 `exit` 退出 MySQL 命令行

## 🔍 访问系统

### 访问 Swagger API 文档

1. 打开你的浏览器
2. 在地址栏输入：`http://localhost:8080/swagger-ui.html`
3. 你应该能看到一个漂亮的 API 文档页面，这里可以查看和测试所有可用的 API 接口

### 测试 API 接口

在 Swagger 页面上，你可以：
1. 点击任何一个 API 接口
2. 点击 "Try it out" 按钮
3. 填写必要的参数
4. 点击 "Execute" 按钮查看结果

## 🧪 运行测试脚本

### 步骤 1：确保测试脚本可执行

1. 输入以下命令：
   ```bash
   chmod +x scripts/test_and_performance_analysis.sh
   ```

### 步骤 2：运行测试脚本

1. 输入以下命令运行测试和性能分析：
   ```bash
   ./scripts/test_and_performance_analysis.sh
   ```
2. 脚本会自动测试所有 API 接口并分析数据库性能
3. 查看输出结果，确保所有测试都通过

## 📊 性能分析说明

在测试脚本的输出中，你会看到类似下面的性能分析结果：

```
聚合查询性能分析:
+----+-------------+-------+-------+------------------+------------------+---------+------+------+--------------------------+
| id | select_type | table | type  | possible_keys    | key              | key_len | ref  | rows | Extra                    |
+----+-------------+-------+-------+------------------+------------------+---------+------+------+--------------------------+
|  1 | SIMPLE      | sales | index | NULL             | idx_sale_date    | 3       | NULL |  100 | Using index; Using temporary; Using filesort |
+----+-------------+-------+-------+------------------+------------------+---------+------+------+--------------------------+
```

**如何解读这个结果：**

- `type`: 显示查询类型，"index" 表示使用了索引，比 "ALL"（全表扫描）性能好
- `rows`: 表示 MySQL 需要检查的行数，这里是 100，说明测试数据有 100 条记录
- `Extra`: 显示额外信息，"Using index" 表示使用了索引

详细的性能分析报告可以在 [db/performance_analysis_results.md](db/performance_analysis_results.md) 文件中查看。

## 🛑 停止服务

当你完成测试后，可以停止服务以节省资源：

1. 在终端中输入以下命令并按回车：
   ```bash
   docker-compose down
   ```
2. 服务将停止运行

## 🔄 重启服务

如果需要重新启动服务，只需再次运行：

```bash
docker-compose up -d
```

## 📝 人工检查清单

请按照以下清单检查项目是否正常工作：

- [ ] Docker Desktop 已成功安装并运行
- [ ] 项目已通过 Docker Compose 成功启动
- [ ] 数据库已成功初始化
- [ ] 测试数据已成功导入
- [ ] 已使用Mockaroo生成1000条随机测试数据（题目要求）
- [ ] Swagger API 文档可以正常访问
- [ ] 测试脚本运行成功，无错误
- [ ] 性能分析结果显示正确的索引使用
- [ ] 聚合查询接口(/api/sales/summary)可以正常工作，支持按日期/产品/地区筛选

## ❓ 常见问题解答

### Q: Docker 安装失败怎么办？
A: 请确保你的 MacOS 版本符合要求，并且有足够的磁盘空间。如果仍然失败，可以尝试重新下载安装包。

### Q: 服务启动后无法访问怎么办？
A: 请检查 Docker 容器是否正常运行，使用 `docker ps` 命令查看。如果容器已停止，可以使用 `docker logs [容器ID]` 查看错误日志。

### Q: 数据库连接失败怎么办？
A: 请检查数据库初始化脚本是否正确执行，可能需要重新运行 `init.sql` 和 `import_data.sql` 脚本。

### Q: 测试脚本运行失败怎么办？
A: 请确保服务已经成功启动，并且数据库中已经有测试数据。

### Q: Mockaroo 数据加载失败怎么办？
A: 可能是网络连接问题或 API 密钥问题。请检查网络连接，并确认在 MockarooDataLoader.java 中配置的 API 密钥是否正确。

## 🎉 恭喜你！

如果你按照这个指南成功运行了项目，那么恭喜你！你已经完成了销售分析系统的部署和测试。这个项目涵盖了 Spring Boot、MyBatis、MySQL、Docker 等现代后端开发技术，对于初学者来说是一个很好的学习案例。

## 📚 学习资源

如果你想进一步学习相关技术，可以查看以下资源：

- [Spring Boot 官方文档](https://spring.io/projects/spring-boot)
- [MyBatis 官方文档](https://mybatis.org/mybatis-3/zh/index.html)
- [MySQL 官方教程](https://dev.mysql.com/doc/)
- [Docker 入门教程](https://docs.docker.com/get-started/)

祝你学习愉快！