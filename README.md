# é”€å”®åˆ†æç³»ç»Ÿ - åç«¯æŠ€æœ¯æ–‡æ¡£

## ğŸ“š é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Spring Boot + MyBatis + MySQL çš„é”€å”®æ•°æ®åˆ†æåç«¯ç³»ç»Ÿï¼Œä¸ºç¼–ç¨‹åˆå­¦è€…è®¾è®¡ï¼Œæä¾›å®Œæ•´çš„ä»å¼€å‘åˆ°éƒ¨ç½²çš„å­¦ä¹ æ¡ˆä¾‹ã€‚

**ä¸»è¦åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- å®Œæ•´çš„é”€å”®æ•°æ® CRUD æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- å¼ºå¤§çš„é”€å”®æ•°æ®èšåˆæŸ¥è¯¢åŠŸèƒ½
- æ‰¹é‡æ•°æ®å¯¼å…¥èƒ½åŠ›
- é›†æˆ Swagger/OpenAPI æ–‡æ¡£
- Docker å®¹å™¨åŒ–éƒ¨ç½²
- å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- æ€§èƒ½ä¼˜åŒ–å’Œç´¢å¼•è®¾è®¡

## ğŸ›  æŠ€æœ¯æ ˆ

- **ç¼–ç¨‹è¯­è¨€**: Java 1.8
- **æ¡†æ¶**: Spring Boot 2.7.x
- **ORM æ¡†æ¶**: MyBatis 3.5.x
- **æ•°æ®åº“**: MySQL 8.0
- **å®¹å™¨åŒ–**: Docker & Docker Compose
- **API æ–‡æ¡£**: Swagger/OpenAPI
- **æµ‹è¯•æ¡†æ¶**: JUnit 5, Mockito

## ğŸ“ é¡¹ç›®ç»“æ„

```
houduanB/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/salesanalysis/
â”‚   â”‚   â”‚   â”œâ”€â”€ Application.java               # Spring Boot åº”ç”¨å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/                    # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SalesController.java       # REST API æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ service/                       # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SalesService.java          # æœåŠ¡æ¥å£
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ impl/SalesServiceImpl.java # æœåŠ¡å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/                        # MyBatis æ˜ å°„å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SalesMapper.java           # æ•°æ®è®¿é—®æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ model/                         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sales.java                 # é”€å”®æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SalesSummary.java          # é”€å”®æ±‡æ€»æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ config/                        # é…ç½®ç±»
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SwaggerConfig.java         # Swagger é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ util/                          # å·¥å…·ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ MockarooClient.java        # Mockaroo API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚       â”œâ”€â”€ MockarooDataGenerator.java # Mockaroo æ•°æ®ç”Ÿæˆå™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ MockarooDataLoader.java    # Mockaroo æ•°æ®åŠ è½½å™¨
â”‚   â”‚   â”‚       â””â”€â”€ DateUtils.java             # æ—¥æœŸå·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ mapper/SalesMapper.xml         # MyBatis XML æ˜ å°„æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ mybatis-config.xml             # MyBatis é…ç½®æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ application.yml                # Spring Boot é…ç½®
â”‚   â”‚       â””â”€â”€ static/                        # é™æ€èµ„æº
â”‚   â””â”€â”€ test/                                  # å•å…ƒæµ‹è¯•
â”‚       â””â”€â”€ java/com/salesanalysis/            # æµ‹è¯•ä»£ç 
â”œâ”€â”€ db/                                        # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ init.sql                               # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ import_data.sql                        # æµ‹è¯•æ•°æ®å¯¼å…¥è„šæœ¬
â”‚   â”œâ”€â”€ explain_analysis.sql                   # SQLæ€§èƒ½åˆ†æè„šæœ¬
â”‚   â””â”€â”€ performance_analysis_results.md        # SQLæ€§èƒ½åˆ†ææŠ¥å‘Š
â”œâ”€â”€ scripts/                                   # è„šæœ¬å·¥å…·
â”‚   â””â”€â”€ test_and_performance_analysis.sh       # æµ‹è¯•å’Œæ€§èƒ½åˆ†æè„šæœ¬
â”œâ”€â”€ Dockerfile                                 # Docker æ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml                         # Docker Compose é…ç½®
â”œâ”€â”€ pom.xml                                    # Maven é¡¹ç›®é…ç½®
â”œâ”€â”€ run_mockaroo_data_loader.sh                # Mockarooæ•°æ®åŠ è½½è„šæœ¬
â””â”€â”€ README.md                                  # é¡¹ç›®æ–‡æ¡£
```

## âš™ï¸ ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£… Docker Desktop

Docker æ˜¯ä¸€ä¸ªå®¹å™¨åŒ–å¹³å°ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨éš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡Œåº”ç”¨ç¨‹åºã€‚

**MacOS å®‰è£…æ­¥éª¤ï¼š**
1. è®¿é—® [Docker å®˜æ–¹ç½‘ç«™](https://docs.docker.com/desktop/install/mac-install/)
2. ä¸‹è½½é€‚åˆ M1 Pro èŠ¯ç‰‡çš„ Docker Desktop
3. å®‰è£…å®Œæˆåï¼Œå¯åŠ¨ Docker Desktop
4. ç¡®ä¿ Docker æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆå³ä¸Šè§’ä¼šæœ‰ Docker å›¾æ ‡ï¼‰

### 2. éªŒè¯ Docker å®‰è£…

æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ Docker æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```bash
docker --version
docker-compose --version
```

å¦‚æœèƒ½çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

å¦‚æœè¿™æ˜¯ä» GitHub å…‹éš†çš„é¡¹ç›®ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
git clone [é¡¹ç›®åœ°å€]
cd houduanB
```

å¦‚æœæ˜¯ç›´æ¥ä¸‹è½½çš„é¡¹ç›®æ–‡ä»¶ï¼Œç›´æ¥è¿›å…¥é¡¹ç›®ç›®å½•å³å¯ã€‚

### 2. ä½¿ç”¨ Docker Compose å¯åŠ¨é¡¹ç›®

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
docker-compose up -d
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
- ä¸‹è½½ MySQL å’Œæ‰€éœ€çš„ Docker é•œåƒ
- å¯åŠ¨ MySQL æ•°æ®åº“æœåŠ¡
- æ„å»ºå¹¶å¯åŠ¨ Spring Boot åº”ç”¨
- åˆ›å»ºå¿…è¦çš„æ•°æ®å·å’Œç½‘ç»œé…ç½®

### 3. åˆå§‹åŒ–æ•°æ®åº“

æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼š

```bash
# è¿›å…¥ db ç›®å½•
cd db

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
docker exec -i $(docker ps -q -f name=mysql) mysql -u root -prootpassword < init.sql

# å¯¼å…¥æµ‹è¯•æ•°æ®
docker exec -i $(docker ps -q -f name=mysql) mysql -u root -prootpassword < import_data.sql
```

### 4. ç”Ÿæˆå¹¶å¯¼å…¥æµ‹è¯•æ•°æ®

ç³»ç»Ÿæ”¯æŒä½¿ç”¨ Mockaroo API ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼š

```bash
# è¿è¡Œ Mockaroo æ•°æ®åŠ è½½è„šæœ¬
./run_mockaroo_data_loader.sh
```

### 5. éªŒè¯æœåŠ¡å¯åŠ¨

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

- **Spring Boot åº”ç”¨**ï¼šè®¿é—® http://localhost:8080
- **Swagger API æ–‡æ¡£**ï¼šè®¿é—® http://localhost:8080/swagger-ui.html
- **æ•°æ®åº“è¿æ¥**ï¼šä½¿ç”¨ MySQL å®¢æˆ·ç«¯è¿æ¥ localhost:3306

## ğŸ” API æ¥å£æ–‡æ¡£

ç³»ç»Ÿæä¾›ä»¥ä¸‹ RESTful API æ¥å£ï¼š

### 1. è·å–æ‰€æœ‰é”€å”®æ•°æ®

```
GET /api/sales
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
[
  {
    "id": 1,
    "saleDate": "2023-06-15T00:00:00.000+0000",
    "product": "äº§å“A",
    "region": "åä¸œ",
    "amount": 1299.99
  }
]
```

### 2. æŒ‰ ID è·å–é”€å”®æ•°æ®

```
GET /api/sales/{id}
```

**å‚æ•°ï¼š**
- `id`: é”€å”®è®°å½• ID

### 3. åˆ›å»ºé”€å”®è®°å½•

```
POST /api/sales
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "saleDate": "2023-06-15",
  "product": "æ–°äº§å“",
  "region": "ååŒ—",
  "amount": 999.99
}
```

### 4. æ›´æ–°é”€å”®è®°å½•

```
PUT /api/sales/{id}
```

**å‚æ•°ï¼š**
- `id`: é”€å”®è®°å½• ID

**è¯·æ±‚ä½“ï¼š**
```json
{
  "id": 1,
  "saleDate": "2023-06-16",
  "product": "æ›´æ–°äº§å“",
  "region": "åå—",
  "amount": 1599.99
}
```

### 5. åˆ é™¤é”€å”®è®°å½•

```
DELETE /api/sales/{id}
```

**å‚æ•°ï¼š**
- `id`: é”€å”®è®°å½• ID

### 6. è·å–é”€å”®æ±‡æ€»æ•°æ®

```
GET /api/sales/summary
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `date` (å¯é€‰): æŒ‰æ—¥æœŸç­›é€‰ (æ ¼å¼: YYYY-MM-DD)
- `product` (å¯é€‰): æŒ‰äº§å“ç­›é€‰
- `region` (å¯é€‰): æŒ‰åœ°åŒºç­›é€‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
[
  {
    "date": "2023-06-15",
    "product": "äº§å“A",
    "region": "åä¸œ",
    "totalAmount": 1299.99,
    "count": 1
  }
]
```

### 7. æ‰¹é‡å¯¼å…¥é”€å”®æ•°æ®

```
POST /api/sales/batch
```

**è¯·æ±‚ä½“ï¼š**
```json
[
  {
    "saleDate": "2023-06-20",
    "product": "æ‰¹é‡äº§å“1",
    "region": "æ‰¹é‡åœ°åŒº1",
    "amount": 599.99
  },
  {
    "saleDate": "2023-06-21",
    "product": "æ‰¹é‡äº§å“2",
    "region": "æ‰¹é‡åœ°åŒº2",
    "amount": 799.99
  }
]
```

## ğŸ“Š æ•°æ®åº“è¯´æ˜

### æ•°æ®åº“è¡¨ç»“æ„

**sales è¡¨ï¼š**

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | æè¿° |
|-------|---------|------|------|
| id | INT | PRIMARY KEY AUTO_INCREMENT | é”€å”®è®°å½•ID |
| sale_date | DATE | NOT NULL | é”€å”®æ—¥æœŸ |
| product | VARCHAR(255) | NOT NULL | äº§å“åç§° |
| region | VARCHAR(255) | NOT NULL | é”€å”®åœ°åŒº |
| amount | DECIMAL(10,2) | NOT NULL | é”€å”®é‡‘é¢ |

### ç´¢å¼•è®¾è®¡

ç³»ç»Ÿåœ¨ä»¥ä¸‹å­—æ®µä¸Šåˆ›å»ºäº†ç´¢å¼•ï¼Œä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼š
- `idx_sale_date` (sale_date): åŠ é€Ÿæ—¥æœŸç­›é€‰
- `idx_product` (product): åŠ é€Ÿäº§å“ç­›é€‰
- `idx_region` (region): åŠ é€Ÿåœ°åŒºç­›é€‰

## ğŸ§ª è¿è¡Œæµ‹è¯•

### 1. è¿è¡Œå•å…ƒæµ‹è¯•

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
# ä½¿ç”¨ Maven è¿è¡Œæµ‹è¯•
mvn test
```

### 2. è¿è¡ŒåŠŸèƒ½æµ‹è¯•å’Œæ€§èƒ½åˆ†æ

ä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬ï¼š

```bash
# è¿è¡Œæµ‹è¯•å’Œæ€§èƒ½åˆ†æè„šæœ¬
./scripts/test_and_performance_analysis.sh
```

## ğŸ’» å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

å¦‚æœä½ æƒ³åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­è¿è¡Œé¡¹ç›®ï¼Œéœ€è¦ï¼š

1. ç¡®ä¿å·²å®‰è£… Java 1.8 å’Œ Maven
2. å¯åŠ¨æœ¬åœ° MySQL æ•°æ®åº“
3. ä¿®æ”¹ `application.yml` ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
4. è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
mvn spring-boot:run
```

### ç”Ÿæˆå¤§é‡æµ‹è¯•æ•°æ®

å¯ä»¥ä½¿ç”¨ Mockaroo API ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼š

```bash
# è¿è¡Œ Mockaroo æ•°æ®åŠ è½½è„šæœ¬
./run_mockaroo_data_loader.sh
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç´¢å¼•ä¼˜åŒ–

ç³»ç»Ÿå·²åœ¨å¸¸ç”¨æŸ¥è¯¢å­—æ®µä¸Šåˆ›å»ºäº†ç´¢å¼•ï¼Œä½†åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. åˆ›å»ºå¤åˆç´¢å¼•ï¼šå¦‚æœç»å¸¸åŒæ—¶æŒ‰æ—¥æœŸå’Œäº§å“æŸ¥è¯¢ï¼Œå¯ä»¥åˆ›å»ºå¤åˆç´¢å¼•
2. å®šæœŸä¼˜åŒ–è¡¨ï¼šä½¿ç”¨ `OPTIMIZE TABLE sales;` å‘½ä»¤ä¼˜åŒ–è¡¨ç©ºé—´
3. ç›‘æ§æ…¢æŸ¥è¯¢ï¼šé…ç½® MySQL æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œåˆ†ææ€§èƒ½ç“¶é¢ˆ

### æŸ¥è¯¢ä¼˜åŒ–

1. é¿å…å…¨è¡¨æ‰«æï¼Œå°½é‡ä½¿ç”¨ç´¢å¼•å­—æ®µè¿›è¡Œç­›é€‰
2. åˆç†è®¾ç½®æŸ¥è¯¢æ¡ä»¶ï¼Œé¿å…ä¸å¿…è¦çš„æ•°æ®åŠ è½½
3. å¯¹äºèšåˆæŸ¥è¯¢ï¼Œç¡®ä¿æ­£ç¡®ä½¿ç”¨ GROUP BY å’Œç´¢å¼•

### SQLæ€§èƒ½åˆ†æ

é¡¹ç›®åŒ…å«è¯¦ç»†çš„SQLæ€§èƒ½åˆ†ææŠ¥å‘Šï¼š

- [SQLæ€§èƒ½åˆ†æè„šæœ¬](db/explain_analysis.sql)
- [SQLæ€§èƒ½åˆ†ææŠ¥å‘Š](db/performance_analysis_results.md)

## ğŸš¢ éƒ¨ç½²è¯´æ˜

### ä½¿ç”¨ Docker Compose éƒ¨ç½²

```bash
docker-compose up -d
```

### ç¯å¢ƒå˜é‡é…ç½®

å¯ä»¥é€šè¿‡ä¿®æ”¹ docker-compose.yml ä¸­çš„ç¯å¢ƒå˜é‡æ¥è‡ªå®šä¹‰é…ç½®ï¼š

- `MYSQL_ROOT_PASSWORD`: MySQL æ ¹å¯†ç 
- `MYSQL_DATABASE`: æ•°æ®åº“åç§°
- `SPRING_DATASOURCE_URL`: æ•°æ®åº“è¿æ¥ URL
- `SPRING_DATASOURCE_USERNAME`: æ•°æ®åº“ç”¨æˆ·å
- `SPRING_DATASOURCE_PASSWORD`: æ•°æ®åº“å¯†ç 

## ğŸ›¡ å®‰å…¨æ³¨æ„äº‹é¡¹

1. ç”Ÿäº§ç¯å¢ƒä¸­è¯·ä¿®æ”¹é»˜è®¤å¯†ç 
2. é™åˆ¶æ•°æ®åº“è®¿é—®æƒé™
3. è€ƒè™‘æ·»åŠ  API è®¤è¯æœºåˆ¶
4. å®šæœŸæ›´æ–°ä¾èµ–åº“ä»¥ä¿®å¤å®‰å…¨æ¼æ´

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### é¡¹ç›®åŠŸèƒ½éªŒè¯

- [ ] æ•°æ®åº“è¡¨æ˜¯å¦æˆåŠŸåˆ›å»º
- [ ] æµ‹è¯•æ•°æ®æ˜¯å¦æˆåŠŸå¯¼å…¥
- [ ] Spring Boot åº”ç”¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
- [ ] Swagger æ–‡æ¡£æ˜¯å¦å¯è®¿é—®
- [ ] æ‰€æœ‰ API æ¥å£æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] èšåˆæŸ¥è¯¢åŠŸèƒ½æ˜¯å¦æ­£ç¡®
- [ ] æ€§èƒ½åˆ†æç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ

### å¸¸è§é—®é¢˜æ’æŸ¥

1. **æœåŠ¡æ— æ³•å¯åŠ¨**ï¼šæ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ŒDocker æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. **æ•°æ®åº“è¿æ¥å¤±è´¥**ï¼šæ£€æŸ¥æ•°æ®åº“é…ç½®å’Œç½‘ç»œè¿æ¥
3. **API è°ƒç”¨å¤±è´¥**ï¼šæŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Œæ£€æŸ¥é”™è¯¯ä¿¡æ¯
4. **æ€§èƒ½é—®é¢˜**ï¼šæ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿å¯¹é¡¹ç›®è¿›è¡Œè´¡çŒ®ï¼å¦‚æœä½ å‘ç°ä»»ä½•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ· Pull Request

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚

## ğŸ“® è”ç³»æ–¹å¼

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»ã€‚